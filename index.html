<!DOCTYPE html>
<html>
<head>
	<title>Login</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

<style>

body {

width:100%;
height:100%;
margin:0 auto;
padding:0;

}

#boxUp {

width:100%;
height:100px;
background: red;
display:flex;
justify-content: flex-end;

}

form {

margin:auto;

}	

input {

display:block;
margin: auto;
margin-top:8px;
padding:10px;
text-decoration:none;
outline:none;

}

label {

margin:auto;
display:block;
text-align:center;
font-family: sans-serif;
font-weight:bold;
padding-top:5px;

}

input[type="button"]{

width:90px;
height:60px;
margin-bottom:20px;

}

input[type="text"],input[type="password"]{

width:300px;

}

input[type="text"]:focus,input[type="password"]:focus {

border:1px green solid;

}

#boxMain {

width:100%;
height:250px;
background: blue;
display:flex;
justify-content: flex-center;

}

#boxJokes {

overflow-y:auto; 
overflow-x:hidden; 
height:400px;
max-height:500px;
width:100%;
background:red;

}

#jokeButton {

margin:auto;

}

#logoutBox {

width:100px;
height:100px;
background:green;
display:none; 

}

.joke {

width:100%;
height:70px;
background:green;
margin-top:10px;
font-size:25px;
text-align:center;
line-height: 70px;

}

</style>

<div id="boxUp">
	<div id='logoutBox'><input type='button' value='logout' class='logoutBtn' onclick='logout()'></div>
</div>

<div id="boxMain">

<form>
	<label>Username</label>
	<input type="text" name="username" id="field1">
	<label>Password</label>
	<input type="password" name="pass" id="field2">
	<input type="button" name="submit" value="Login" onclick="getData()">
</form>

<!--<input type="button" id="jokeButton" value="Get joke">-->
</div>

<div id="boxJokes">

<!--<div class="joke"></div>-->

</div>

<script type="text/javascript">

function getData(){

/*variables values from form*/
let nickname=document.getElementsByName("username")[0].value;
let pass=document.getElementsByName("pass")[0].value;

/*
let clear1=document.getElementById("field1");
let clear2=document.getElementById("field2");
clear1.value = '';
clear2.value = '';*/

xhr = new XMLHttpRequest();
let url = "http://itsovy.sk:1201/login";
xhr.open("POST", url, true);
xhr.setRequestHeader("Content-type", "application/json");
xhr.onreadystatechange = function () { 
    
    console.log(xhr.status);

    if (xhr.readyState == 4 && xhr.status == 200) {
        let json = JSON.parse(xhr.responseText);

        /*session*/
        sessionStorage.setItem('loginName', json.login);
        sessionStorage.setItem('loginToken', json.token);
       	/*variable for session*/
       	let token=sessionStorage.getItem('loginToken');
        let enteredName=sessionStorage.getItem('loginName');
       	console.log(token);
        console.log(enteredName);

        document.getElementsByTagName("form")[0].style.display="none";
        document.getElementById("logoutBox").style.display="block";

        $( "#boxMain" ).append( "<input type='button' id='jokeButton' value='Get joke' onclick='getJoke()'>" );
    
    }

}

let data = JSON.stringify({login:nickname,password:pass});
xhr.send(data);

}

function getJoke(){

let token=sessionStorage.getItem('loginToken');
let enteredName=sessionStorage.getItem('loginName');
console.log(xhr.status);
console.log(token);
console.log(enteredName);

xhr = new XMLHttpRequest();
let url = "http://itsovy.sk:1201/joke";
xhr.open("POST", url, true);
xhr.setRequestHeader("Content-type", "application/json");
xhr.onreadystatechange = function () { 
    if (xhr.readyState == 4 && xhr.status == 200) {
      let json = JSON.parse(xhr.responseText);
        
      let joke = json.joke
      $( "#boxJokes" ).append( "<div class='joke'>"+joke+"</div>" );

    }
}
let data = JSON.stringify({login:enteredName,token:token});
xhr.send(data);

}

function logout(){

  let token=sessionStorage.getItem('loginToken');
  let enteredName=sessionStorage.getItem('loginName');
  console.log(xhr.status);
  console.log(token);
  console.log(enteredName);

  xhr = new XMLHttpRequest();
  let url = "http://itsovy.sk:1201/logout";
  xhr.open("POST", url, true);
  xhr.setRequestHeader("Content-type", "application/json");
  xhr.onreadystatechange = function () { 
      if (xhr.readyState == 4 && xhr.status == 200) {
       
        document.getElementsByTagName("form")[0].style.display="block";
        document.getElementById("logoutBox").style.display="none";

        $( "#jokeButton" ).remove();

      }
  }
  let data = JSON.stringify({login:enteredName,token:token});
  xhr.send(data);

}

</script>

</body>
</html>